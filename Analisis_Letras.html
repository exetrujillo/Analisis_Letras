<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.30">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Exequiel Trujillo Escobar">
<meta name="dcterms.date" content="2024-12-03">
<meta name="description" content="Exploración y análisis de letras de canciones utilizando la API de LRC Lib.">

<title>Análisis de Letras</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Analisis_Letras_files/libs/clipboard/clipboard.min.js"></script>
<script src="Analisis_Letras_files/libs/quarto-html/quarto.js"></script>
<script src="Analisis_Letras_files/libs/quarto-html/popper.min.js"></script>
<script src="Analisis_Letras_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Analisis_Letras_files/libs/quarto-html/anchor.min.js"></script>
<link href="Analisis_Letras_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Analisis_Letras_files/libs/quarto-html/quarto-syntax-highlighting-ff893972f9265553e75a68b2562ffb69.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Analisis_Letras_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Analisis_Letras_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Analisis_Letras_files/libs/bootstrap/bootstrap-1be1f0925cd6979720c4a96057840954.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


<link rel="stylesheet" href="styles.css">
</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Análisis de Letras</h1>
</div>

<div>
  <div class="description">
    Exploración y análisis de letras de canciones utilizando la API de LRC Lib.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Exequiel Trujillo Escobar </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 3, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introducción" class="level1">
<h1>Introducción</h1>
<p>Este proyecto utiliza R para realizar análisis de letras de canciones. Se usará la database de [LRCLIB](<a href="https://lrclib.net/db-dumps" class="uri">https://lrclib.net/db-dumps</a>)</p>
<section id="tareas-por-hacer-todo" class="level4">
<h4 class="anchored" data-anchor-id="tareas-por-hacer-todo">Tareas por hacer (ToDo):</h4>
<ul>
<li><p><strong>Validación de entradas:</strong></p>
<ul>
<li><p>Asegurarse de manejar caracteres especiales en el nombre del artista para evitar errores en la consulta SQL. Por ejemplo, usando <code>dbQuoteString</code>:</p>
<p><code>nombre_artista &lt;- dbQuoteString(conexion, tolower(nombre_artista))</code></p></li>
<li><p>Revisar si es necesario consultar lyrics después de filtrar los lyrics_ids, en lugar de usar un JOIN simplemente en la consulta SQL inicial. Esto lo hice inicialmente porque el número de filas en la tabla tracks y la tabla lyrics no coincidían y la de lyrics tenía más.</p></li>
<li><p>Manejo de duplicados:</p>
<ul>
<li><p>¿Preferir la existencia de letras sincronizadas? (<code>has_synced_lyrics = 1</code>).</p></li>
<li><p>¿Elegir el registro más reciente? (<code>updated_at</code> más alto. implica modificar ).</p></li>
</ul></li>
<li><p>La conexión a la base de datos podría estar en una función separada.</p></li>
<li><p>Mejora en la visualización:</p>
<ul>
<li>Para inspeccionar el <code>dataframe</code> resultante, usar librerías como <code>DT</code> o <code>kableExtra</code></li>
</ul></li>
<li><p>Análisis:</p>
<ul>
<li><p>Frecuencias de palabras</p></li>
<li><p>¿Sentimientos? ¿Emociones?</p></li>
<li><p>Gráficos ggplot</p></li>
</ul></li>
<li><p>Explorar la existencia de paquetes para estudios lingüísticos y literarios con reconocimiento de pátrones de lenguaje por gramática en español.</p></li>
</ul></li>
</ul>
</section>
<section id="instalación-de-librerías" class="level2">
<h2 class="anchored" data-anchor-id="instalación-de-librerías">Instalación de librerías</h2>
<p>Primero, cargamos las librerías necesarias:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pacman)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(httr,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>       jsonlite,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>       dplyr,</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>       rvest,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>       DBI,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>       RSQLite</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()) <span class="co"># Descomentar si necesitamos limpiar entorno</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="exploración-de-la-base-de-datos" class="level1">
<h1>Exploración de la base de datos</h1>
<p>Aquí importamos la base de datos, sus tablas y el tipo de información que pueden contener</p>
<section id="importar-base-de-datos" class="level2">
<h2 class="anchored" data-anchor-id="importar-base-de-datos">Importar base de datos</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Conectar a la base de datos</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>db_file <span class="ot">&lt;-</span> <span class="st">"db.sqlite3"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>conn <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(RSQLite<span class="sc">::</span><span class="fu">SQLite</span>(), <span class="at">dbname =</span> db_file)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Listar tablas</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># tables &lt;- dbListTables(conn)</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># print(tables)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>El resultado son las siguientes tablas:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<tbody>
<tr class="odd">
<td>“_litestream_lock”</td>
<td>“_litestream_seq”</td>
<td>“flags”</td>
<td>“lyrics”</td>
<td>“missing_tracks”</td>
<td>“sqlite_sequence”</td>
</tr>
<tr class="even">
<td>“tracks”</td>
<td>“tracks_fts”</td>
<td>“tracks_fts_config”</td>
<td>“tracks_fts_data”</td>
<td>“tracks_fts_docsize”</td>
<td>“tracks_fts_idx”</td>
</tr>
</tbody>
</table>
</section>
<section id="exploramos-las-tablas" class="level2">
<h2 class="anchored" data-anchor-id="exploramos-las-tablas">Exploramos las tablas</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Leer los primeros registros de una tabla</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># data &lt;- dbGetQuery(conn, "SELECT * FROM lyrics LIMIT 10")</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># print(data)</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Consultar la estructura de la tabla</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>columns <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(conn, <span class="st">"PRAGMA table_info(lyrics)"</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   cid              name     type notnull dflt_value pk
1    0                id  INTEGER       0         NA  1
2    1      plain_lyrics     TEXT       0         NA  0
3    2     synced_lyrics     TEXT       0         NA  0
4    3          track_id  INTEGER       0         NA  0
5    4  has_plain_lyrics  BOOLEAN       0         NA  0
6    5 has_synced_lyrics  BOOLEAN       0         NA  0
7    6      instrumental  BOOLEAN       0         NA  0
8    7            source     TEXT       0         NA  0
9    8        created_at DATETIME       0         NA  0
10   9        updated_at DATETIME       0         NA  0</code></pre>
</div>
</div>
</section>
<section id="estructura-de-las-tablas-de-interés" class="level2">
<h2 class="anchored" data-anchor-id="estructura-de-las-tablas-de-interés">Estructura de las tablas de interés</h2>
<p>Nos interesa particularmente la tabla tracks y la tabla lyrics</p>
<section id="tracks" class="level3">
<h3 class="anchored" data-anchor-id="tracks">Tracks</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 23%">
<col style="width: 23%">
<col style="width: 28%">
<col style="width: 24%">
</colgroup>
<thead>
<tr class="header">
<th>Columna</th>
<th>Tipo</th>
<th>Descripción</th>
<th>Ejemplo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>id</code></td>
<td>INT</td>
<td>Clave primaria de la tabla. Usada para identificar de manera única cada canción o pista.</td>
<td>3</td>
</tr>
<tr class="even">
<td><code>name</code></td>
<td>TEXT</td>
<td>Nombre de la canción o pista. Es sensible a mayúsculas y minúsculas.</td>
<td>Wildest Dreams</td>
</tr>
<tr class="odd">
<td><code>name_lower</code></td>
<td>TEXT</td>
<td>Versión en minúsculas del nombre de la pista (<code>name</code>).</td>
<td>wildest dreams</td>
</tr>
<tr class="even">
<td><code>artist_name</code></td>
<td>TEXT</td>
<td>Nombre del artista que interpreta la canción. Sensible a mayúsculas y minúsculas.</td>
<td>ZAYN feat. Sia</td>
</tr>
<tr class="odd">
<td><code>artist_name_lower</code></td>
<td>TEXT</td>
<td>Versión en minúsculas del nombre del artista (<code>artist_name</code>).</td>
<td>zayn feat sia</td>
</tr>
<tr class="even">
<td><code>album_name</code></td>
<td>TEXT</td>
<td>Nombre del álbum en el que se encuentra la canción.</td>
<td>Dusk Till Dawn (Radio Edit)</td>
</tr>
<tr class="odd">
<td><code>album_name_lower</code></td>
<td>TEXT</td>
<td>Versión en minúsculas del nombre del álbum (<code>album_name</code>).</td>
<td>dusk till dawn radio edit</td>
</tr>
<tr class="even">
<td><code>duration</code></td>
<td>FLOAT</td>
<td>Duración de la canción en segundos.</td>
<td>239</td>
</tr>
<tr class="odd">
<td><code>last_lyrics_id</code></td>
<td>INT</td>
<td>Referencia a otra tabla (como <code>lyrics</code>) que almacena las letras de las canciones. Algunas no coinciden con <code>id</code> necesariamente.</td>
<td>3</td>
</tr>
<tr class="even">
<td><code>created_at</code></td>
<td>DATE</td>
<td>Representa la fecha y la hora en que se creó el registro.</td>
<td>2022-11-14 11:46:45.978+00:00</td>
</tr>
<tr class="odd">
<td><code>updated_at</code></td>
<td>DATE</td>
<td>Indica la fecha (y hora) en que se actualizó por última vez el registro.</td>
<td>2022-11-14 11:46:45.978+00:00</td>
</tr>
</tbody>
</table>
</section>
<section id="lyrics" class="level3">
<h3 class="anchored" data-anchor-id="lyrics">Lyrics</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 23%">
<col style="width: 23%">
<col style="width: 28%">
<col style="width: 24%">
</colgroup>
<thead>
<tr class="header">
<th>Columna</th>
<th>Tipo</th>
<th>Descripción</th>
<th>Ejemplo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>id</code></td>
<td>INT</td>
<td>Clave primaria de la tabla, única para cada registro de letras.</td>
<td>3</td>
</tr>
<tr class="even">
<td><code>plain_lyrics</code></td>
<td>TEXT</td>
<td>Letras de la canción en formato simple (sin sincronización con la música).</td>
<td>Not tryna be indie\nNot tryna be cool\nJust tryna be in this\nTell me, are you too?\n\nCan […]</td>
</tr>
<tr class="odd">
<td><code>synced_lyrics</code></td>
<td>TEXT</td>
<td>Letras sincronizadas, con marcas de tiempo para seguir la canción mientras se reproduce.</td>
<td>[00:09.66] Not tryna be indie\n[00:12.30] Not tryna be cool\n[00:14.99] Just tryna be in […]</td>
</tr>
<tr class="even">
<td><code>track_id</code></td>
<td>INT</td>
<td>Clave foránea que referencia la columna <code>id</code> en la tabla <code>tracks</code>. Esto vincula las letras con las canciones.</td>
<td>3</td>
</tr>
<tr class="odd">
<td><code>has_plain_lyrics</code></td>
<td>BOOLEAN</td>
<td>Indica si hay letras simples disponibles ([<code>TRUE</code> = 1] o [<code>FALSE</code> = 0]).</td>
<td>1</td>
</tr>
<tr class="even">
<td><code>has_synced_lyrics</code></td>
<td>BOOLEAN</td>
<td>Indica si hay letras sincronizadas disponibles ([<code>TRUE</code> = 1] o [<code>FALSE</code> = 0]).</td>
<td>1</td>
</tr>
<tr class="odd">
<td><code>instrumental</code></td>
<td>BOOLEAN</td>
<td>Indica si la pista es instrumental y, por lo tanto, no tiene letras. ([<code>TRUE</code> = 1] o [<code>FALSE</code> = 0]).</td>
<td>0</td>
</tr>
<tr class="even">
<td><code>source</code></td>
<td>TEXT</td>
<td>Fuente de las letras (La mayoría está en NA).</td>
<td>NA</td>
</tr>
<tr class="odd">
<td><code>created_at</code></td>
<td>DATE</td>
<td>Fecha y hora de creación del registro.</td>
<td>2022-11-14 11:46:45.978+00:00</td>
</tr>
<tr class="even">
<td><code>updated_at</code></td>
<td>DATE</td>
<td>Fecha y hora de la última actualización del registro.</td>
<td>2022-11-14 11:46:45.978+00:00</td>
</tr>
</tbody>
</table>
</section>
</section>
</section>
<section id="definición-de-funciones" class="level1">
<h1>Definición de funciones</h1>
<p>Ya teniendo claridad de la estructura de las tablas que nos interesan, comenzaremos a crear las funciones que nos permitan crear nuestros propios data frames y analizar las canciones que nos interesen.</p>
<section id="variables-iniciales-de-ejemplo" class="level2">
<h2 class="anchored" data-anchor-id="variables-iniciales-de-ejemplo">Variables iniciales de ejemplo</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>artista_ej <span class="ot">&lt;-</span> <span class="st">"Niños del Cerro"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="normalizar-nombre-de-artista" class="level2">
<h2 class="anchored" data-anchor-id="normalizar-nombre-de-artista">Normalizar nombre de artista</h2>
<p>Normalizar los nombres de los artistas es estandarizar su “formato” para que sean uniformes, independientemente de cómo estén registrados en la base de datos o ingresados por el usuario. Esto es útil para evitar problemas como registros duplicados o consultas fallidas debido a diferencias en mayúsculas, espacios, acentos, o caracteres especiales, como la ñ en “Niños del Cerro”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>normalizarNombre <span class="ot">&lt;-</span> <span class="cf">function</span>(nombre_artista) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(stringi)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  nombre_artista <span class="ot">&lt;-</span> <span class="fu">tolower</span>(nombre_artista)                          <span class="co"># Minúsculas</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  nombre_artista <span class="ot">&lt;-</span> <span class="fu">trimws</span>(nombre_artista)                           <span class="co"># Espacios</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  nombre_artista <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>, <span class="st">" "</span>, nombre_artista)                <span class="co"># Espacios</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  nombre_artista <span class="ot">&lt;-</span> <span class="fu">stri_trans_general</span>(nombre_artista, <span class="st">"Latin-ASCII"</span>) <span class="co"># Acentos</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  nombre_artista <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"[^a-z0-9 ]"</span>, <span class="st">""</span>, nombre_artista)           <span class="co"># Puntuación</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(nombre_artista)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Lo probamos</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>artista_ej_normalizado <span class="ot">&lt;-</span> <span class="fu">normalizarNombre</span>(artista_ej)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(artista_ej_normalizado)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ninos del cerro"</code></pre>
</div>
</div>
<p>Se ve que el resultado es “ninos del cerro”, sin espacios, ni ñ, ni mayúsculas.</p>
</section>
<section id="obtener-canciones-de-un-artista-con-las-letras" class="level2">
<h2 class="anchored" data-anchor-id="obtener-canciones-de-un-artista-con-las-letras">Obtener canciones de un artista con las letras</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Función para buscar canciones de un artista y agregar información de letras</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>buscarPorArtista <span class="ot">&lt;-</span> <span class="cf">function</span>(nombre_artista_normalizado, conexion) {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Paso 1: Buscar las canciones del artista en la tabla tracks</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  tracks_query <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT name, artist_name, album_name, duration, last_lyrics_id </span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM tracks </span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="st">    WHERE artist_name_lower = '%s'</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="st">  "</span>, <span class="fu">tolower</span>(nombre_artista_normalizado))</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Obtener las canciones del artista</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  tracks_data <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(conexion, tracks_query)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Verificar si se encontraron canciones</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(tracks_data) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"No se encontraron canciones para este artista.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Paso 2: Recorrer la tabla lyrics y obtener información adicional</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Crear una consulta para obtener las letras correspondientes a last_lyrics_id</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  lyrics_ids <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">na.omit</span>(tracks_data<span class="sc">$</span>last_lyrics_id))  <span class="co"># Eliminar NA y duplicados</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(lyrics_ids) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Ninguna canción tiene letras asociadas.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(tracks_data)</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  lyrics_query <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">"</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT id AS last_lyrics_id, plain_lyrics, synced_lyrics, </span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="st">           has_plain_lyrics, has_synced_lyrics, instrumental</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM lyrics </span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="st">    WHERE id IN (%s)</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="st">  "</span>, <span class="fu">paste</span>(lyrics_ids, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Obtener los datos de letras</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>  lyrics_data <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(conexion, lyrics_query)</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Paso 3: Unir los datos de tracks con los de letras</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Usamos un merge para unir los datos basados en last_lyrics_id</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">merge</span>(tracks_data, lyrics_data, <span class="at">by =</span> <span class="st">"last_lyrics_id"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Retornar el dataframe final</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Ejemplo de uso de la función con nombre normalizado</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>df_artista_ej <span class="ot">&lt;-</span> <span class="fu">buscarPorArtista</span>(artista_ej_normalizado, conn)</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar las primeras filas del dataframe final</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_artista_ej)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  last_lyrics_id                   name     artist_name
1        1318298                Capital Niños Del Cerro
2        1318517                Contigo Niños Del Cerro
3        1318593             Cuauhtémoc Niños Del Cerro
4        1318667                 Daniel Niños Del Cerro
5        1318876 Durmiendo en el Parque Niños Del Cerro
6        1318885 Días Frescos (En Vivo) Niños Del Cerro
                                 album_name duration
1                                Nonato Coo      276
2                                     Lance      224
3                                Cuauhtémoc      219
4                           Suave Pendiente      457
5                                Cuauhtémoc      239
6 No Va a Pasar el Tiempo en Vano (En Vivo)      310
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                plain_lyrics
1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Tuve que buscar, tan lejos,\nTan lejos, allá en otro lugar,\nNos quisieron, nos quisieron tanto.\n\nTuve que viajar, tan lejos,\nTan lejos, allá en otra ciudad,\nNos quisieron, me quisieron tanto.\n\nY sin pensarlo caigo\nY creo que estoy volviendo a empezar,\nLas melodías que inventamos estando en la capital,\nNos llevaron de vuelta a casa.\n\nTuve que buscar, tan lejos,\nTan lejos, de nuestra enfermedad,\nNos quisimos, nos quisimos tanto.\n\nY te salí a buscar, de noche,\nCon el miedo, no me hicieron daño,\nMe quisieron, me quisieron tanto.\n\nY sin pensarlo caigo\nY creo que estoy volviendo a empezar,\nLas melodías que inventamos estando en la capital,\nNos llevaron de vuelta a casa.
2                                                                                                                   No se conocen, no saben de dónde\nSalió, quien se esconde, detrás de sus ojos\nEsta noche, bailemos entonces\nMmm\n\nNo se conocen, son nueve de doce\nLos que corresponden, para que esto sea una buena idea\nDime lo que quieras\nYo solo quiero avanzar\n\nAtravesando la pared, viajando al sur en bus\nSe oyen tantas voces, voces que no reconoces\nAtravesando la pared, viajando al sur en bus\nSe oyen tantas voces, oh, yo nunca he ido a Conce\n\nContigo me siento menos mal\nContigo ya puedo empezar\n\nNo se conocen, son nueve de doce\nLos que corresponden, para que esto sea una buena idea\nDime lo que quieras, yo solo quiero mejorarme\n\nAtravesando la pared, viajando al sur en bus\nSe oyen tantas voces, voces que no reconoces\nAtravesando la pared, viajando al sur en bus\nSe oyen tantas voces, oh, yo nunca he ido a Conce\n\nContigo me siento menos mal\nContigo ya puedo empezar\n\nA planear mi escape al fin\nMás allá de todo lo que te pedí\nA sacar desde dentro lo que hoy pretendo\nHacer, a sacar desde dentro canciones sin temer a perder
3                                                                                                                                                                                                                                            Hijo mío\nHoy te escribo\nMalherido, desnutrido\nMe quemaron, pies y manos\nY no entiendo si sirvió de algo o no\n\n¿Qué pasó? ¿Te rompió el corazón?\n¿Qué pasó? ¿Te dolió mi dolor?\n¿Qué cambió? Si perdimos igual\nVen que nos volvemos por Cuauhtémoc\n\nDime si esperar\nPor lo menos dime si estarás\nQue no quiero verte más llorar\nPor lo menos dime algo\n\nMe contento con los restos\nDe mi cuerpo hoy enfermo\nMe quemaron, pies y manos\nY no entiendo nada nada de esto\n\n¿Qué pasó? ¿Te rompió el corazón?\n¿Qué pasó? ¿Te dolió mi dolor?\n¿Qué cambió? Si perdimos todo igual\nVen que nos volvemos por Cuauhtémoc\n\nDime si esperar\nPor lo menos dime si estarás\nQue no quiero verte más llorar\nPor lo menos dime algo más\n\nQue no estés tan triste\nY dónde es que te fuiste\nSi sobreviviste hasta primavera\nDudo que lo sepa, antes que me muera\nPor lo menos dime algo\n\nMe contento con los restos\nDe mi cuerpo hoy enfermo
4 No me hace ni una gracia\nNo me hace ni una gracia\nNi un favor\nEsta pobre intervención\n\nEn mi mano un arma blanca\nEn mi mano un proyectil\nUna bengala\nMe ilumina el corazón\n\nY no me hace ni una gracia\nNo me hace ni una gracia\nNi un favor\nEsta pobre intervención\n\nEn mi mano un arma blanca\nEn mi mano un arma blanca del color\nDel color de este dolor\n\nNada que perder\nNada que creer\nDel dolor vivo, diente de niño\n\nUn dos tres por mí y por nadie más\nMi único amigo\nEl deseo de ahogarme lento\n\nNo me hace ni una gracia\nNi una gracia ni un favor que no he pedido\nEsta pobre intervención\n\nEn mi mano un arma blanca\nEn mi mano un proyectil\nUna bengala\nMe ilumina el corazón\n\nY en la jaula, los leones que\nY en la jaula los leones me entregué\nY encontré algo mejor\n\nY en la jaula, los leones que\nY en la jaula los leones me entegué\nMe trataron con amor\n\nNada que perder\nNada que creer\nDel dolor vivo, diente de niño\n\nUn dos tres por mí y por nadie más\nMi único amigo\n\nFiesta en el jardín\nUn lugar feliz\nDonde yo vivo, polvo y olvido\n\nUn dos tres por mí y por nadie más\nMi único amigo\nEl deseo de ahogarme lento hoy
5                                                                                                                                                                                                                                     'Toy durmiendo en el parque\nPorfa vuelve a buscarme\n'Toy durmiendo en el parque\nPorfa vuelve a taparme\n\nAmor, soy yo o nuestros ritmos son muy distintos\nTienes la razón\n\nHoy prefiero quedarme viendo un pasaje libre de intervenciones\nDonde poder detenerme un rato a llorar\n\n'Toy durmiendo en el parque\nPorfa vuelve a buscarme\n'Toy durmiendo en el parque\nPorfa vuelve a taparme\n\nAmor, soy yo o nuestros ritmos son muy distintos\nTienes la razón\n\nHoy prefiero quedarme viendo un pasaje libre de intervenciones\nDonde poder detenerme un rato a llorar\nPor todas mis perverciones\nHoy prefiero quedarme viendo un pasaje libre de intervenciones\nDonde poder detenerme un rato a llorar\n\nHoy prefiero quedarme viendo un pasaje libre de intervenciones\nDonde poder detenerme un rato a llorar\nPor todas mis perverciones\nHoy prefiero quedarme viendo un pasaje libre de intervenciones\nDonde poder detenerme un rato a llorar
6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Este sol no me lo merezco\nNi el amor de los días frescos\nNi los árboles que cortan la luz que me viene a castigar\nEstas nubes que te estuve pidiendo\nNunca me llegaron a tiempo\nMe atraparon, me abrazaron, me violaron\nY me hicieron volver a creer\nSon los ruidos que me encontré\nMelodías que te robé\nEs la mierda que me hace tan bien\nEste calor no me lo merezco\nNi menos la sombra de los días frescos\nNi todos los árboles que se abalanzan sobre mí
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           synced_lyrics
1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 [00:24.94] Tuve que buscar, tan lejos,\n[00:30.85] Tan lejos, allá en otro lugar,\n[00:37.17] Nos quisieron, nos quisieron tanto.\n[00:51.76] Tuve que viajar, tan lejos,\n[00:57.90] Tan lejos, allá en otra ciudad,\n[01:04.38] Nos quisieron, me quisieron tanto.\n[01:11.94] Y sin pensarlo caigo\n[01:15.86] Y creo que estoy volviendo a empezar,\n[01:21.01] Las melodías que inventamos estando en la capital,\n[01:30.07] Nos llevaron de vuelta a casa.\n[01:56.59] Tuve que buscar, tan lejos,\n[02:03.11] Tan lejos, de nuestra enfermedad,\n[02:09.47] Nos quisimos, nos quisimos tanto.\n[02:14.50] Y te salí a buscar, de noche,\n[02:20.35] Con el miedo, no me hicieron daño,\n[02:27.15] Me quisieron, me quisieron tanto.\n[02:41.65] Y sin pensarlo caigo\n[02:45.57] Y creo que estoy volviendo a empezar,\n[02:50.78] Las melodías que inventamos estando en la capital,\n[02:59.74] Nos llevaron de vuelta a casa.\n[03:08.27] 
2                                                                                                                                                                                                                                                                                                                                       [00:29.49] No se conocen, no saben de dónde\n[00:32.96] Salió, quien se esconde, detrás de sus ojos\n[00:36.72] Esta noche, bailemos entonces\n[00:40.63] Mmm\n[00:44.65] No se conocen, son nueve de doce\n[00:47.90] Los que corresponden, para que esto sea una buena idea\n[00:53.21] Dime lo que quieras\n[00:55.84] Yo solo quiero avanzar\n[01:00.10] Atravesando la pared, viajando al sur en bus\n[01:03.64] Se oyen tantas voces, voces que no reconoces\n[01:08.03] Atravesando la pared, viajando al sur en bus\n[01:11.27] Se oyen tantas voces, oh, yo nunca he ido a Conce\n[01:15.01] Contigo me siento menos mal\n[01:22.63] Contigo ya puedo empezar\n[01:41.92] No se conocen, son nueve de doce\n[01:45.53] Los que corresponden, para que esto sea una buena idea\n[01:50.51] Dime lo que quieras, yo solo quiero mejorarme\n[01:57.24] Atravesando la pared, viajando al sur en bus\n[02:00.98] Se oyen tantas voces, voces que no reconoces\n[02:05.30] Atravesando la pared, viajando al sur en bus\n[02:08.78] Se oyen tantas voces, oh, yo nunca he ido a Conce\n[02:12.78] Contigo me siento menos mal\n[02:19.16] Contigo ya puedo empezar\n[02:27.54] A planear mi escape al fin\n[02:31.19] Más allá de todo lo que te pedí\n[02:35.45] A sacar desde dentro lo que hoy pretendo\n[02:39.31] Hacer, a sacar desde dentro canciones sin temer a perder\n[02:55.69] 
3                                                                                                                                                                                                                                                                                                                                                                                            [00:00.67] Hijo mío\n[00:03.39] Hoy te escribo\n[00:06.39] Malherido, desnutrido\n[00:12.40] Me quemaron, pies y manos\n[00:18.19] Y no entiendo si sirvió de algo o no\n[00:25.47] ¿Qué pasó? ¿Te rompió el corazón?\n[00:31.64] ¿Qué pasó? ¿Te dolió mi dolor?\n[00:37.70] ¿Qué cambió? Si perdimos igual\n[00:43.59] Ven que nos volvemos por Cuauhtémoc\n[01:02.04] Dime si esperar\n[01:06.30] Por lo menos dime si estarás\n[01:11.86] Que no quiero verte más llorar\n[01:17.29] Por lo menos dime algo\n[01:24.47] Me contento con los restos\n[01:29.79] De mi cuerpo hoy enfermo\n[01:35.45] Me quemaron, pies y manos\n[01:41.00] Y no entiendo nada nada de esto\n[01:48.11] ¿Qué pasó? ¿Te rompió el corazón?\n[01:53.69] ¿Qué pasó? ¿Te dolió mi dolor?\n[01:59.11] ¿Qué cambió? Si perdimos todo igual\n[02:04.92] Ven que nos volvemos por Cuauhtémoc\n[02:12.44] \n[02:34.20] Dime si esperar\n[02:38.43] Por lo menos dime si estarás\n[02:43.75] Que no quiero verte más llorar\n[02:49.51] Por lo menos dime algo más\n[02:54.82] Que no estés tan triste\n[02:57.82] Y dónde es que te fuiste\n[03:00.65] Si sobreviviste hasta primavera\n[03:06.53] Dudo que lo sepa, antes que me muera\n[03:11.87] Por lo menos dime algo\n[03:26.80] Me contento con los restos\n[03:32.50] De mi cuerpo hoy enfermo\n[03:38.06] 
4 [00:08.63] No me hace ni una gracia\n[00:12.73] No me hace ni una gracia\n[00:14.99] Ni un favor\n[00:17.45] Esta pobre intervención\n[00:20.99] En mi mano un arma blanca\n[00:25.15] En mi mano un proyectil\n[00:27.09] Una bengala\n[00:29.77] Me ilumina el corazón\n[00:33.59] Y no me hace ni una gracia\n[00:37.89] No me hace ni una gracia\n[00:39.60] Ni un favor\n[00:42.33] Esta pobre intervención\n[00:45.67] En mi mano un arma blanca\n[00:49.96] En mi mano un arma blanca del color\n[00:54.17] Del color de este dolor\n[00:57.86] \n[01:14.41] Nada que perder\n[01:16.55] Nada que creer\n[01:18.53] Del dolor vivo, diente de niño\n[01:22.47] Un dos tres por mí y por nadie más\n[01:26.71] Mi único amigo\n[01:28.76] El deseo de ahogarme lento\n[01:34.69] No me hace ni una gracia\n[01:38.83] Ni una gracia ni un favor que no he pedido\n[01:43.70] Esta pobre intervención\n[01:47.25] En mi mano un arma blanca\n[01:51.27] En mi mano un proyectil\n[01:53.31] Una bengala\n[01:55.98] Me ilumina el corazón\n[01:59.57] Y en la jaula, los leones que\n[02:03.80] Y en la jaula los leones me entregué\n[02:08.02] Y encontré algo mejor\n[02:11.81] Y en la jaula, los leones que\n[02:16.02] Y en la jaula los leones me entegué\n[02:20.39] Me trataron con amor\n[02:24.47] \n[03:21.66] Nada que perder\n[03:23.52] Nada que creer\n[03:25.84] Del dolor vivo, diente de niño\n[03:29.56] Un dos tres por mí y por nadie más\n[03:33.70] Mi único amigo\n[03:37.71] Fiesta en el jardín\n[03:40.05] Un lugar feliz\n[03:41.81] Donde yo vivo, polvo y olvido\n[03:46.05] Un dos tres por mí y por nadie más\n[03:50.43] Mi único amigo\n[03:52.37] El deseo de ahogarme lento hoy\n[03:59.72] 
5                                                                                                                                                                                                                                                                                                                                                                                                                                                 [00:00.24] 'Toy durmiendo en el parque\n[00:04.51] Porfa vuelve a buscarme\n[00:08.23] 'Toy durmiendo en el parque\n[00:12.14] Porfa vuelve a taparme\n[00:15.74] Amor, soy yo o nuestros ritmos son muy distintos\n[00:23.74] Tienes la razón\n[00:31.32] Hoy prefiero quedarme viendo un pasaje libre de intervenciones\n[00:38.66] Donde poder detenerme un rato a llorar\n[00:43.16] \n[00:50.39] 'Toy durmiendo en el parque\n[00:54.06] Porfa vuelve a buscarme\n[00:57.99] 'Toy durmiendo en el parque\n[01:01.67] Porfa vuelve a taparme\n[01:05.06] Amor, soy yo o nuestros ritmos son muy distintos\n[01:13.18] Tienes la razón\n[01:16.77] \n[01:20.84] Hoy prefiero quedarme viendo un pasaje libre de intervenciones\n[01:28.33] Donde poder detenerme un rato a llorar\n[01:32.92] Por todas mis perverciones\n[01:36.08] Hoy prefiero quedarme viendo un pasaje libre de intervenciones\n[01:43.68] Donde poder detenerme un rato a llorar\n[01:47.92] \n[03:03.14] Hoy prefiero quedarme viendo un pasaje libre de intervenciones\n[03:11.27] Donde poder detenerme un rato a llorar\n[03:15.95] Por todas mis perverciones\n[03:18.84] Hoy prefiero quedarme viendo un pasaje libre de intervenciones\n[03:26.50] Donde poder detenerme un rato a llorar\n[03:30.47] 
6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   &lt;NA&gt;
  has_plain_lyrics has_synced_lyrics instrumental
1                1                 1            0
2                1                 1            0
3                1                 1            0
4                1                 1            0
5                1                 1            0
6                1                 0            0</code></pre>
</div>
</div>
<p>Arroja 47 filas con 10 variables. Hay sumar los campos de actualizado y subido (fechas).</p>
</section>
<section id="resolver-casos-duplicados" class="level2">
<h2 class="anchored" data-anchor-id="resolver-casos-duplicados">Resolver casos duplicados</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#resolverDuplicados &lt;- function(data) {</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#  }</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#df_filtrado &lt;- resolverDuplicados(df_artista_ejemplo)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>